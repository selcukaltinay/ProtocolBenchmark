<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LPWAN Test Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .status-running {
            background: #10b981;
            color: white;
        }
        
        .status-stopped {
            background: #ef4444;
            color: white;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
        }
        
        .btn-start {
            background: #10b981;
            color: white;
        }
        
        .btn-start:hover {
            background: #059669;
            transform: translateY(-2px);
        }
        
        .btn-stop {
            background: #ef4444;
            color: white;
        }
        
        .btn-stop:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }
        
        .btn-refresh {
            background: #3b82f6;
            color: white;
        }
        
        .btn-refresh:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }
        
        .overall-progress {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        .progress-bar {
            width: 100%;
            height: 40px;
            background: #e5e7eb;
            border-radius: 20px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .protocol-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .protocol-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .protocol-card:hover {
            transform: translateY(-5px);
        }
        
        .protocol-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        
        .protocol-stats {
            font-size: 0.9em;
            color: #6b7280;
            margin: 5px 0;
        }
        
        .mini-progress {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .mini-progress-fill {
            height: 100%;
            background: #10b981;
            transition: width 0.5s ease;
        }
        
        .charts-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }
        
        .logs-section {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        .logs-title {
            color: #10b981;
            font-size: 1.5em;
            margin-bottom: 15px;
        }
        
        .logs-content {
            background: #1f2937;
            border-radius: 10px;
            padding: 20px;
            color: #10b981;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .timestamp {
            color: #9ca3af;
            font-size: 0.85em;
            margin-top: 10px;
        }

        .filters-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #667eea;
        }

        .filter-group select {
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.9em;
            background: white;
            cursor: pointer;
        }

        .filter-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .stats-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .stats-table th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }

        .stats-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #e5e7eb;
        }

        .stats-table tr:hover {
            background: #f9fafb;
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-export {
            background: #8b5cf6;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-export:hover {
            background: #7c3aed;
            transform: translateY(-2px);
        }

        .metric-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
            margin: 2px;
        }

        .badge-good {
            background: #10b981;
            color: white;
        }

        .badge-medium {
            background: #f59e0b;
            color: white;
        }

        .badge-bad {
            background: #ef4444;
            color: white;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.9);
        }

        .tab.active {
            background: white;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üöÄ LPWAN Protocol Test Dashboard</h1>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <span id="statusBadge" class="status-badge status-stopped">‚è∏ Durduruldu</span>
                    <span class="timestamp" id="lastUpdate">Son g√ºncelleme: -</span>
                </div>
                <div class="controls">
                    <button class="btn btn-start" onclick="startExperiment()">‚ñ∂ Ba≈ülat</button>
                    <button class="btn btn-stop" onclick="stopExperiment()">‚èπ Durdur</button>
                    <button class="btn btn-refresh" onclick="refreshData()">üîÑ Yenile</button>
                </div>
            </div>
        </div>
        
        <!-- Overall Progress -->
        <div class="overall-progress">
            <h2>Genel ƒ∞lerleme</h2>
            <div class="progress-bar">
                <div class="progress-fill" id="overallProgress" style="width: 0%">0%</div>
            </div>
            <p id="overallStats">0 / 0 test tamamlandƒ±</p>
        </div>
        
        <!-- Protocol Cards -->
        <div class="protocol-grid" id="protocolGrid"></div>

        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active" onclick="switchTab('overview')">Genel Bakƒ±≈ü</div>
            <div class="tab" onclick="switchTab('detailed')">Detaylƒ± ƒ∞statistikler</div>
            <div class="tab" onclick="switchTab('network')">Aƒü Ko≈üullarƒ±</div>
            <div class="tab" onclick="switchTab('filter')">Filtreleme</div>
        </div>

        <!-- Tab: Overview -->
        <div id="tab-overview" class="tab-content active">
            <div class="charts-section">
                <h2>üìä Protokol Kar≈üƒ±la≈ütƒ±rmasƒ±</h2>
                <div class="chart-container">
                    <canvas id="comparisonChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="latencyChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="throughputChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Tab: Detailed Stats -->
        <div id="tab-detailed" class="tab-content">
            <div class="stats-section">
                <h2>üìà Detaylƒ± ƒ∞statistikler</h2>
                <div class="export-buttons">
                    <button class="btn-export" onclick="exportData('csv')">üì• CSV ƒ∞ndir</button>
                    <button class="btn-export" onclick="exportData('json')">üì• JSON ƒ∞ndir</button>
                </div>
                <div id="detailedStatsContent"></div>
            </div>
        </div>

        <!-- Tab: Network Conditions -->
        <div id="tab-network" class="tab-content">
            <div class="charts-section">
                <h2>üåê Aƒü Ko≈üullarƒ± Bazlƒ± Kar≈üƒ±la≈ütƒ±rma</h2>
                <h3 style="margin-top: 20px;">Bandwidth Bazlƒ±</h3>
                <div class="chart-container">
                    <canvas id="bandwidthChart"></canvas>
                </div>
                <h3 style="margin-top: 20px;">Paket Kaybƒ± Bazlƒ±</h3>
                <div class="chart-container">
                    <canvas id="lossChart"></canvas>
                </div>
                <h3 style="margin-top: 20px;">Gecikme Bazlƒ±</h3>
                <div class="chart-container">
                    <canvas id="delayChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Tab: Filter -->
        <div id="tab-filter" class="tab-content">
            <div class="filters-section">
                <h2>üîç Veri Filtreleme</h2>
                <div class="filter-grid">
                    <div class="filter-group">
                        <label>Protokol</label>
                        <select id="filterProtocol" onchange="applyFilters()">
                            <option value="">T√ºm√º</option>
                            <option value="mqtt">MQTT</option>
                            <option value="coap-con">CoAP-CON</option>
                            <option value="coap-non">CoAP-NON</option>
                            <option value="mqtt-sn">MQTT-SN</option>
                            <option value="zenoh">Zenoh</option>
                            <option value="http">HTTP</option>
                            <option value="amqp">AMQP</option>
                            <option value="xmpp">XMPP</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Bandwidth</label>
                        <select id="filterBandwidth" onchange="applyFilters()">
                            <option value="">T√ºm√º</option>
                            <option value="50kbit">50 kbit</option>
                            <option value="100kbit">100 kbit</option>
                            <option value="250kbit">250 kbit</option>
                            <option value="1mbit">1 mbit</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Paket Kaybƒ±</label>
                        <select id="filterLoss" onchange="applyFilters()">
                            <option value="">T√ºm√º</option>
                            <option value="0%">0%</option>
                            <option value="1%">1%</option>
                            <option value="5%">5%</option>
                            <option value="10%">10%</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Gecikme (ms)</label>
                        <select id="filterDelay" onchange="applyFilters()">
                            <option value="">T√ºm√º</option>
                            <option value="0">0 ms</option>
                            <option value="20">20 ms</option>
                            <option value="100">100 ms</option>
                            <option value="500">500 ms</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Payload (bytes)</label>
                        <select id="filterPayload" onchange="applyFilters()">
                            <option value="">T√ºm√º</option>
                            <option value="16">16 bytes</option>
                            <option value="128">128 bytes</option>
                        </select>
                    </div>
                </div>
                <div id="filteredDataContent" style="margin-top: 20px;"></div>
            </div>
        </div>
        
        <!-- Logs -->
        <div class="logs-section">
            <h2 class="logs-title">üìù Canlƒ± Loglar</h2>
            <div class="logs-content" id="logsContent">Loglar y√ºkleniyor...</div>
        </div>
    </div>
    
    <script>
        let comparisonChart = null;
        let latencyChart = null;
        let throughputChart = null;
        let bandwidthChart = null;
        let lossChart = null;
        let delayChart = null;

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById('tab-' + tabName).classList.add('active');
            event.target.classList.add('active');

            // Load data for specific tabs
            if (tabName === 'detailed') loadDetailedStats();
            if (tabName === 'network') loadNetworkConditions();
        }
        
        // Verileri y√ºkle
        async function loadStatus() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                
                // Status badge g√ºncelle
                const badge = document.getElementById('statusBadge');
                if (data.running) {
                    badge.className = 'status-badge status-running';
                    badge.textContent = '‚ñ∂ √áalƒ±≈üƒ±yor';
                } else {
                    badge.className = 'status-badge status-stopped';
                    badge.textContent = '‚è∏ Durduruldu';
                }
                
                // Genel ilerleme
                const overall = data.overall;
                document.getElementById('overallProgress').style.width = overall.percentage + '%';
                document.getElementById('overallProgress').textContent = overall.percentage + '%';
                document.getElementById('overallStats').textContent = 
                    `${overall.completed} / ${overall.total} test tamamlandƒ±`;
                
                // Protokol kartlarƒ±
                const grid = document.getElementById('protocolGrid');
                grid.innerHTML = '';
                
                for (const [proto, stats] of Object.entries(data.protocols)) {
                    const card = document.createElement('div');
                    card.className = 'protocol-card';
                    card.innerHTML = `
                        <div class="protocol-name">${proto}</div>
                        <div class="protocol-stats">‚úÖ Tamamlanan: ${stats.completed}</div>
                        <div class="protocol-stats">üìã Toplam: ${stats.total}</div>
                        <div class="protocol-stats">üìä ƒ∞lerleme: ${stats.percentage}%</div>
                        <div class="mini-progress">
                            <div class="mini-progress-fill" style="width: ${stats.percentage}%"></div>
                        </div>
                    `;
                    grid.appendChild(card);
                }
                
                // Timestamp g√ºncelle
                document.getElementById('lastUpdate').textContent = 
                    'Son g√ºncelleme: ' + new Date(data.timestamp).toLocaleTimeString('tr-TR');
                
            } catch (error) {
                console.error('Status y√ºklenirken hata:', error);
            }
        }
        
        // Kar≈üƒ±la≈ütƒ±rma grafiklerini y√ºkle
        async function loadComparison() {
            try {
                const response = await fetch('/api/comparison');
                const data = await response.json();
                
                if (data.length === 0) return;
                
                const protocols = data.map(d => d.protocol);
                const deliveryRatios = data.map(d => d.avg_delivery);
                const latencies = data.map(d => d.avg_latency);
                const throughputs = data.map(d => d.avg_throughput);
                
                // Delivery Ratio Chart
                const ctx1 = document.getElementById('comparisonChart');
                if (comparisonChart) comparisonChart.destroy();
                
                comparisonChart = new Chart(ctx1, {
                    type: 'bar',
                    data: {
                        labels: protocols,
                        datasets: [{
                            label: 'Ortalama Delivery Ratio (%)',
                            data: deliveryRatios,
                            backgroundColor: 'rgba(102, 126, 234, 0.8)',
                            borderColor: 'rgba(102, 126, 234, 1)',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
                
                // Latency Chart
                const ctx2 = document.getElementById('latencyChart');
                if (latencyChart) latencyChart.destroy();
                
                latencyChart = new Chart(ctx2, {
                    type: 'line',
                    data: {
                        labels: protocols,
                        datasets: [{
                            label: 'Ortalama Latency (ms)',
                            data: latencies,
                            backgroundColor: 'rgba(16, 185, 129, 0.2)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });

                // Throughput Chart
                const ctx3 = document.getElementById('throughputChart');
                if (throughputChart) throughputChart.destroy();

                throughputChart = new Chart(ctx3, {
                    type: 'bar',
                    data: {
                        labels: protocols,
                        datasets: [{
                            label: 'Ortalama Throughput (bps)',
                            data: throughputs,
                            backgroundColor: 'rgba(139, 92, 246, 0.8)',
                            borderColor: 'rgba(139, 92, 246, 1)',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });

            } catch (error) {
                console.error('Kar≈üƒ±la≈ütƒ±rma y√ºklenirken hata:', error);
            }
        }

        // Detaylƒ± istatistikleri y√ºkle
        async function loadDetailedStats() {
            try {
                const response = await fetch('/api/detailed-stats');
                const data = await response.json();

                let html = '<table class="stats-table"><thead><tr><th>Protokol</th><th>Metrik</th><th>Ortalama</th><th>Min</th><th>Max</th><th>Median</th><th>P95</th><th>Std Dev</th></tr></thead><tbody>';

                for (const [proto, stats] of Object.entries(data)) {
                    if (stats.error) continue;

                    // Delivery stats
                    const d = stats.delivery;
                    const deliveryBadge = d.mean >= 95 ? 'badge-good' : d.mean >= 80 ? 'badge-medium' : 'badge-bad';
                    html += `<tr><td rowspan="4"><strong>${proto.toUpperCase()}</strong></td><td>Delivery Ratio (%)</td><td><span class="metric-badge ${deliveryBadge}">${d.mean}</span></td><td>${d.min}</td><td>${d.max}</td><td>${d.median}</td><td>${d.p95}</td><td>${d.std}</td></tr>`;

                    // Latency stats
                    const l = stats.latency;
                    html += `<tr><td>Latency (ms)</td><td>${l.mean}</td><td>${l.min}</td><td>${l.max}</td><td>${l.median}</td><td>${l.p95}</td><td>${l.std}</td></tr>`;

                    // Jitter stats
                    const j = stats.jitter;
                    html += `<tr><td>Jitter (ms)</td><td>${j.mean}</td><td>${j.min}</td><td>${j.max}</td><td>${j.median}</td><td>-</td><td>-</td></tr>`;

                    // Throughput stats
                    const t = stats.throughput;
                    html += `<tr><td>Throughput (bps)</td><td>${t.mean}</td><td>${t.min}</td><td>${t.max}</td><td>${t.median}</td><td>-</td><td>-</td></tr>`;
                }

                html += '</tbody></table>';
                document.getElementById('detailedStatsContent').innerHTML = html;

            } catch (error) {
                console.error('Detaylƒ± stats y√ºklenirken hata:', error);
            }
        }

        // Aƒü ko≈üullarƒ± kar≈üƒ±la≈ütƒ±rmasƒ±nƒ± y√ºkle
        async function loadNetworkConditions() {
            try {
                const response = await fetch('/api/network-conditions');
                const data = await response.json();

                // Bandwidth Chart
                const bwLabels = Object.keys(data.by_bandwidth);
                const protocols = ['mqtt', 'coap-con', 'coap-non', 'mqtt-sn', 'zenoh', 'http', 'amqp', 'xmpp'];
                const colors = ['#667eea', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#06b6d4', '#ec4899', '#6366f1'];

                const bwDatasets = protocols.map((proto, idx) => ({
                    label: proto.toUpperCase(),
                    data: bwLabels.map(bw => data.by_bandwidth[bw][proto]?.delivery || 0),
                    backgroundColor: colors[idx],
                    borderColor: colors[idx],
                    borderWidth: 2
                }));

                const ctx4 = document.getElementById('bandwidthChart');
                if (bandwidthChart) bandwidthChart.destroy();

                bandwidthChart = new Chart(ctx4, {
                    type: 'bar',
                    data: {
                        labels: bwLabels,
                        datasets: bwDatasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                title: { display: true, text: 'Delivery Ratio (%)' }
                            }
                        }
                    }
                });

                // Loss Chart
                const lossLabels = Object.keys(data.by_loss);
                const lossDatasets = protocols.map((proto, idx) => ({
                    label: proto.toUpperCase(),
                    data: lossLabels.map(loss => data.by_loss[loss][proto]?.delivery || 0),
                    backgroundColor: colors[idx],
                    borderColor: colors[idx],
                    borderWidth: 2
                }));

                const ctx5 = document.getElementById('lossChart');
                if (lossChart) lossChart.destroy();

                lossChart = new Chart(ctx5, {
                    type: 'line',
                    data: {
                        labels: lossLabels,
                        datasets: lossDatasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                title: { display: true, text: 'Delivery Ratio (%)' }
                            }
                        }
                    }
                });

                // Delay Chart
                const delayLabels = Object.keys(data.by_delay);
                const delayDatasets = protocols.map((proto, idx) => ({
                    label: proto.toUpperCase(),
                    data: delayLabels.map(delay => data.by_delay[delay][proto]?.latency || 0),
                    backgroundColor: colors[idx],
                    borderColor: colors[idx],
                    borderWidth: 2,
                    fill: false
                }));

                const ctx6 = document.getElementById('delayChart');
                if (delayChart) delayChart.destroy();

                delayChart = new Chart(ctx6, {
                    type: 'line',
                    data: {
                        labels: delayLabels,
                        datasets: delayDatasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: { display: true, text: 'Latency (ms)' }
                            }
                        }
                    }
                });

            } catch (error) {
                console.error('Network conditions y√ºklenirken hata:', error);
            }
        }

        // Filtreleri uygula
        async function applyFilters() {
            const protocol = document.getElementById('filterProtocol').value;
            const bandwidth = document.getElementById('filterBandwidth').value;
            const loss = document.getElementById('filterLoss').value;
            const delay = document.getElementById('filterDelay').value;
            const payload_size = document.getElementById('filterPayload').value;

            const params = new URLSearchParams();
            if (protocol) params.append('protocol', protocol);
            if (bandwidth) params.append('bandwidth', bandwidth);
            if (loss) params.append('loss', loss);
            if (delay) params.append('delay', delay);
            if (payload_size) params.append('payload_size', payload_size);

            try {
                const response = await fetch('/api/filtered-data?' + params.toString());
                const data = await response.json();

                let html = `<h3>Filtrelenmi≈ü Sonu√ßlar (${data.length} kayƒ±t)</h3>`;
                html += '<table class="stats-table"><thead><tr><th>Protokol</th><th>BW</th><th>Loss</th><th>Delay</th><th>Payload</th><th>Rate</th><th>Delivery %</th><th>Latency ms</th><th>Throughput</th></tr></thead><tbody>';

                data.forEach(row => {
                    const deliveryBadge = row.DeliveryRatio >= 95 ? 'badge-good' : row.DeliveryRatio >= 80 ? 'badge-medium' : 'badge-bad';
                    html += `<tr>
                        <td><strong>${row.Protocol}</strong></td>
                        <td>${row.Bandwidth}</td>
                        <td>${row.Loss}</td>
                        <td>${row.Delay_ms}ms</td>
                        <td>${row.PayloadSize_bytes}B</td>
                        <td>${row.Rate_msg_s}/s</td>
                        <td><span class="metric-badge ${deliveryBadge}">${row.DeliveryRatio.toFixed(2)}</span></td>
                        <td>${row.LatencyAvg_ms.toFixed(2)}</td>
                        <td>${row.Throughput_bps.toFixed(0)}</td>
                    </tr>`;
                });

                html += '</tbody></table>';
                document.getElementById('filteredDataContent').innerHTML = html;

            } catch (error) {
                console.error('Filtre uygulanƒ±rken hata:', error);
            }
        }

        // Export fonksiyonu
        function exportData(format) {
            window.location.href = `/api/export/${format}`;
        }
        
        // Loglarƒ± y√ºkle
        async function loadLogs() {
            try {
                const response = await fetch('/api/logs');
                const data = await response.json();
                document.getElementById('logsContent').textContent = data.logs;
                
                // Auto-scroll to bottom
                const logsContent = document.getElementById('logsContent');
                logsContent.scrollTop = logsContent.scrollHeight;
            } catch (error) {
                console.error('Loglar y√ºklenirken hata:', error);
            }
        }
        
        // Testi ba≈ülat
        async function startExperiment() {
            if (!confirm('Testleri ba≈ülatmak istediƒüinizden emin misiniz?')) return;
            
            try {
                const response = await fetch('/api/control/start', { method: 'POST' });
                const data = await response.json();
                alert(data.message);
                setTimeout(refreshData, 2000);
            } catch (error) {
                alert('Hata: ' + error);
            }
        }
        
        // Testi durdur
        async function stopExperiment() {
            if (!confirm('Testleri durdurmak istediƒüinizden emin misiniz?')) return;
            
            try {
                const response = await fetch('/api/control/stop', { method: 'POST' });
                const data = await response.json();
                alert(data.message);
                setTimeout(refreshData, 1000);
            } catch (error) {
                alert('Hata: ' + error);
            }
        }
        
        // T√ºm verileri yenile
        async function refreshData() {
            await loadStatus();
            await loadComparison();
            await loadLogs();
        }
        
        // ƒ∞lk y√ºkleme
        refreshData();
        
        // Otomatik yenileme (5 saniyede bir)
        setInterval(refreshData, 5000);
    </script>
</body>
</html>
